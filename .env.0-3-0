# NB_Streamer v0.3.0 Multi-Tenancy Configuration
# Copy this file to .env and customize for your environment

# ===========================================
# REQUIRED CONFIGURATION
# ===========================================

# Graylog Configuration (REQUIRED)
NB_GRAYLOG_HOST=10.0.1.244
NB_GRAYLOG_PORT=12201
NB_GRAYLOG_PROTOCOL=udp

# Multi-tenancy Configuration
# Comma-separated list of allowed tenants
NB_TENANTS=n2con
NB_REQUIRE_TENANT_PATH=true

# ===========================================
# BACKWARD COMPATIBILITY (MIGRATION PERIOD)
# ===========================================

# Legacy tenant ID (for backward compatibility during migration)
# This ensures existing clients continue working
NB_TENANT_ID=n2con

# Allow legacy /events endpoint during migration
NB_ALLOW_LEGACY_EVENTS=true
NB_LEGACY_ENFORCE_MATCH=true

# ===========================================
# AUTHENTICATION (KEEP EXISTING SETTINGS)
# ===========================================

# Authentication method (from existing config)
NB_AUTH_TYPE=bearer
NB_AUTH_TOKEN=NB_STREAMER_FEqa6rCRAMQoEzunR_B9l9APd2S3wRuJylSXyA8r7DI

# ===========================================
# SERVICE CONFIGURATION
# ===========================================

# Server binding
NB_HOST=0.0.0.0
NB_PORT=8080
NB_DEBUG=false

# Reverse proxy settings (for external proxy deployment)
NB_BIND_HOST=127.0.0.1
NB_BIND_PORT=8080
NB_TRUST_PROXY_HEADERS=true

# Logging
NB_LOG_LEVEL=DEBUG

# Message Configuration
NB_COMPRESSION_ENABLED=true
NB_MAX_MESSAGE_SIZE=8192

# ===========================================
# OPTIONAL CONFIGURATION
# ===========================================

# Tenant management
NB_EXPOSE_TENANTS=false

# ===========================================
# MIGRATION PLAN
# ===========================================

# Phase 1: Deploy v0.3.0 with both endpoints active
#   - Legacy: POST /events (requires NB_Tenant: "n2con" in payload)
#   - New: POST /n2con/events (tenant from URL path)
#   - Both use same auth token and forward to same Graylog

# Phase 2: Switch clients to new endpoint
#   - Change client from: POST /events
#   - Change client to: POST /n2con/events
#   - Same auth, same payload (NB_Tenant optional in new endpoint)

# Phase 3: Disable legacy endpoint (after all clients migrated)
#   - Set: NB_ALLOW_LEGACY_EVENTS=false
#   - Remove: NB_TENANT_ID (optional cleanup)

# ===========================================
# DOCKER COMPOSE DEPLOYMENT
# ===========================================

# For external reverse proxy (recommended for this server):
# docker compose -f docker-compose.external-proxy.yml --env-file .env up -d

# External reverse proxy should route:
# https://your-domain.com/n2con/events → http://127.0.0.1:8080/n2con/events
# https://your-domain.com/events → http://127.0.0.1:8080/events (legacy)
# https://your-domain.com/health → http://127.0.0.1:8080/health
